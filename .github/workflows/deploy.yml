name: ğŸš€ é˜¿é‡Œäº‘ OSS å¢é‡éƒ¨ç½²

on:
  push:
    branches: 
      - main

jobs:
  sync-to-oss:
    runs-on: ubuntu-latest
    name: ğŸ”— å…¨è‡ªåŠ¨åŒæ­¥
    steps:
      - name: ğŸ“‚ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ”„ æ‰§è¡ŒåŒæ­¥
        run: |
          # 1. å®‰è£…æ—§ç‰ˆ ossutil
          curl -sSL https://gosspublic.alicdn.com/ossutil/install.sh | sudo bash

          # 2. ç”Ÿæˆé…ç½®æ–‡ä»¶ (æ—§ç‰ˆéœ€è¦è¿™ä¸ª)
          ossutil config --force --access-key-id=$ \
                         --access-key-secret=${{ secrets.ALIYUN_OSS_ACCESS_KEY_SECRET }} \
                         --endpoint=${{ secrets.ALIYUN_OSS_ENDPOINT }}

          # 3. æ‰§è¡ŒåŒæ­¥ (æ³¨æ„è¿™é‡ŒåŠ äº† -r é€’å½’å‚æ•°)
          ossutil sync ./ oss://${{ secrets.ALIYUN_OSS_BUCKET }} \
            -r \          # é€’å½’ä¸Šä¼ å­ç›®å½•
            -f \          # å¼ºåˆ¶æ‰§è¡Œ
            --delete \    # è‡ªåŠ¨åˆ é™¤ OSS ä¸Šå¤šä½™çš„æ–‡ä»¶
            --exclude=".git/" \      # æ’é™¤ .git ç›®å½•
            --exclude=".github/" \  # æ’é™¤ GitHub Actions ç”Ÿæˆçš„ç›®å½•
            --exclude="node_modules/" \ # æ’é™¤ä¾èµ–ç›®å½•
            --exclude="*.log" \     # æ’é™¤æ—¥å¿—æ–‡ä»¶
            --exclude="tmp*"        # æ’é™¤ä¸´æ—¶æ–‡ä»¶
