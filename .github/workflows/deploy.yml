name: ðŸš€ é˜¿é‡Œäº‘ OSS å¢žé‡éƒ¨ç½²

on:
  push:
    branches: 
      - main  # ä¿®æ”¹ä¸ºä½ éœ€è¦ç›‘å¬çš„åˆ†æ”¯åï¼Œå¦‚ "master" æˆ– "main"
    # åªè¦æŽ¨é€åˆ°è¯¥åˆ†æ”¯ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘

jobs:
  sync-to-oss:
    runs-on: ubuntu-latest
    name: ðŸ”— å¢žé‡åŒæ­¥é™æ€æ–‡ä»¶
    steps:
      # 1. æ‹‰å–ä»£ç åˆ°å·¥ä½œæµè™šæ‹Ÿæœº
      - name: ðŸ“‚ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          # å¿…é¡»è®¾ç½®ä¸º 0ï¼ŒèŽ·å–å®Œæ•´çš„ Git åŽ†å²ï¼Œç¡®ä¿èƒ½æ­£ç¡®è¯†åˆ«æ‰€æœ‰æ–‡ä»¶å˜æ›´
          fetch-depth: 0

      # 2. å®‰è£…ä¾èµ–å¹¶æ‰§è¡ŒåŒæ­¥
      - name: ðŸ”„ æ‰§è¡Œå¢žé‡åŒæ­¥
        run: |
          # ä¸‹è½½é˜¿é‡Œäº‘å®˜æ–¹å‘½ä»¤è¡Œå·¥å…· ossutil (Linux 64ä½)
          # å»ºè®®æŸ¥çœ‹é˜¿é‡Œäº‘å®˜æ–¹æ–‡æ¡£èŽ·å–æœ€æ–°ç‰ˆæœ¬é“¾æŽ¥
          wget -O ossutil https://gosspublic.alicdn.com/ossutil/1.8.3/ossutil64
          chmod +x ossutil

          # åˆ›å»º ossutil çš„é…ç½®æ–‡ä»¶
          cat > .ossutilconfig << EOF
          [Credentials]
          language=CH
          accessKeyID=${{ secrets.ALIYUN_OSS_ACCESS_KEY_ID }}
          accessKeySecret=${{ secrets.ALIYUN_OSS_ACCESS_KEY_SECRET }}
          endpoint=${{ secrets.ALIYUN_OSS_ENDPOINT }}
          EOF

          # æ ¸å¿ƒå‘½ä»¤ï¼šæ‰§è¡Œå¢žé‡åŒæ­¥
          # ./ : ä»£è¡¨å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆå³ä½ çš„ HTML/CSS/JSï¼‰
          # oss://ä½ çš„Bucketåœ°å€ : æ›¿æ¢ä¸ºä½ çš„å®žé™…åœ°å€
          # -u / --update : ä»…å½“æºæ–‡ä»¶æ¯”ç›®æ ‡æ–‡ä»¶æ–°ï¼Œæˆ–è€…ç›®æ ‡æ–‡ä»¶ä¸å­˜åœ¨æ—¶æ‰ä¸Šä¼ 
          # -f / --force : å¼ºåˆ¶æ‰§è¡Œï¼ˆé¿å…äº¤äº’ï¼‰
          # -r / --recursive : é€’å½’ä¸Šä¼ ç›®å½•
          ./ossutil cp ./ oss://${{ secrets.ALIYUN_OSS_BUCKET }} -u -r -f
          
