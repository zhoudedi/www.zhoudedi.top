name: ğŸš€ é˜¿é‡Œäº‘ OSS å¢é‡éƒ¨ç½²

on:
  push:
    branches: 
      - main

jobs:
  sync-to-oss:
    runs-on: ubuntu-latest
    name: ğŸ”— å¢é‡åŒæ­¥é™æ€æ–‡ä»¶
    steps:
      - name: ğŸ“‚ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ”„ æ‰§è¡Œå¢é‡åŒæ­¥
        run: |
          # 1. å®‰è£… ossutil 2.0 (å…³é”®ä¿®æ”¹ï¼šæŒ‡å®šå®‰è£… 2.0 ç‰ˆæœ¬)
          # ossutil 2.0 æ”¯æŒ sync å‘½ä»¤å’Œç¯å¢ƒå˜é‡é…ç½®
          curl -sSL https://gosspublic.alicdn.com/ossutil/v2/ossutil2-linux-amd64 | sudo tee /usr/local/bin/ossutil > /dev/null
          sudo chmod 755 /usr/local/bin/ossutil

          # 2. è®¾ç½®ç¯å¢ƒå˜é‡ (ossutil 2.0 ä¼šè‡ªåŠ¨è¯»å–è¿™äº›å˜é‡)
          export OSS_ACCESS_KEY_ID=${{ secrets.ALIYUN_OSS_ACCESS_KEY_ID }}
          export OSS_ACCESS_KEY_SECRET=${{ secrets.ALIYUN_OSS_ACCESS_KEY_SECRET }}
          export OSS_ENDPOINT=${{ secrets.ALIYUN_OSS_ENDPOINT }}

          # 3. æ‰§è¡ŒåŒæ­¥ (ä½¿ç”¨ ossutil 2.0 çš„è¯­æ³•)
          # sync: åŒæ­¥å‘½ä»¤
          # --delete: åˆ é™¤ç›®æ ‡ç«¯å¤šä½™æ–‡ä»¶
          # --update: å¢é‡æ›´æ–°
          # --exclude: æ’é™¤æŒ‡å®šæ–‡ä»¶
          # --force: å¼ºåˆ¶æ‰§è¡Œ
          ossutil sync ./ oss://${{ secrets.ALIYUN_OSS_BUCKET }} \
            --delete \
            --update \
            --exclude=".git*" \
            --exclude=".github*" \
            --exclude="*.log" \
            --exclude="tmp*" \
            --exclude=".DS_Store" \
            --force
