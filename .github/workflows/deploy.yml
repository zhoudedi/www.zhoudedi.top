name: ðŸš€ é˜¿é‡Œäº‘ OSS å¢žé‡éƒ¨ç½²

on:
  push:
    branches: 
      - main  # ä¿®æ”¹ä¸ºä½ éœ€è¦ç›‘å¬çš„åˆ†æ”¯åï¼Œå¦‚ "master" æˆ– "main"

jobs:
  sync-to-oss:
    runs-on: ubuntu-latest
    name: ðŸ”— å¢žé‡åŒæ­¥é™æ€æ–‡ä»¶
    steps:
      # 1. æ‹‰å–ä»£ç åˆ°å·¥ä½œæµè™šæ‹Ÿæœº
      - name: ðŸ“‚ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          # å¿…é¡»è®¾ç½®ä¸º 0ï¼ŒèŽ·å–å®Œæ•´çš„ Git åŽ†å²ï¼Œç¡®ä¿èƒ½æ­£ç¡®è¯†åˆ«æ‰€æœ‰æ–‡ä»¶å˜æ›´
          fetch-depth: 0

      # 2. å®‰è£…ä¾èµ–å¹¶æ‰§è¡ŒåŒæ­¥
      - name: ðŸ”„ æ‰§è¡Œå¢žé‡åŒæ­¥
        run: |
          # ä¸‹è½½å¹¶æ‰§è¡Œå®˜æ–¹å®‰è£…è„šæœ¬
          # æ³¨æ„ï¼šä½¿ç”¨ sudo ç¡®ä¿æœ‰æƒé™å®‰è£…åˆ° /usr/bin ç›®å½•
          curl -s https://gosspublic.alicdn.com/ossutil/install.sh | sudo bash

          # 2. åˆ›å»º ossutil çš„é…ç½®æ–‡ä»¶
          # æ³¨æ„ï¼šä¸éœ€è¦ chmodï¼Œå› ä¸ºå®‰è£…è„šæœ¬å·²ç»å¤„ç†å¥½äº†
          cat > ~/.ossutilconfig << EOF
          [Credentials]
          language=CH
          accessKeyID=${{ secrets.ALIYUN_OSS_ACCESS_KEY_ID }}
          accessKeySecret=${{ secrets.ALIYUN_OSS_ACCESS_KEY_SECRET }}
          endpoint=${{ secrets.ALIYUN_OSS_ENDPOINT }}
          EOF

          # 3. æ‰§è¡Œå¢žé‡åŒæ­¥
          # å…³é”®ä¿®æ­£ï¼šç›´æŽ¥ä½¿ç”¨ ossutil å‘½ä»¤ï¼Œä¸è¦åŠ  ./ å‰ç¼€
          # -u å‚æ•°ï¼šä»…åŒæ­¥æ›´æ–°çš„æ–‡ä»¶ï¼ˆå®žçŽ°ä½ çš„â€œåªä¼ ä¿®æ”¹æ–‡ä»¶â€éœ€æ±‚ï¼‰
          # -r å‚æ•°ï¼šé€’å½’ä¸Šä¼ ç›®å½•
          ossutil cp ./www/ oss://${{ secrets.ALIYUN_OSS_BUCKET }} -u -r -f
