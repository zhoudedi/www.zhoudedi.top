name: ğŸš€ é˜¿é‡Œäº‘ OSS å¢é‡éƒ¨ç½²

on:
  push:
    branches: 
      - main

jobs:
  sync-to-oss:
    runs-on: ubuntu-latest
    name: ğŸ”— å¢é‡åŒæ­¥é™æ€æ–‡ä»¶
    steps:
      - name: ğŸ“‚ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ”„ æ‰§è¡Œå¢é‡åŒæ­¥
        run: |
          # ä¸‹è½½å¹¶å®‰è£… ossutil
          curl -s https://gosspublic.alicdn.com/ossutil/install.sh | sudo bash

          # é…ç½®ç¯å¢ƒå˜é‡ (æ¨èæ–¹å¼ï¼Œæ¯”å†™æ–‡ä»¶æ›´ç®€æ´)
          export OSS_ACCESS_KEY_ID=${{ secrets.ALIYUN_OSS_ACCESS_KEY_ID }}
          export OSS_ACCESS_KEY_SECRET=${{ secrets.ALIYUN_OSS_ACCESS_KEY_SECRET }}
          export OSS_ENDPOINT=${{ secrets.ALIYUN_OSS_ENDPOINT }}

          # æ ¸å¿ƒåŒæ­¥å‘½ä»¤
          # --exclude=".git*": æ’é™¤ .git ç›®å½•å’Œ .gitignore æ–‡ä»¶
          # --exclude=".github*": æ’é™¤ GitHub Actions ç›¸å…³æ–‡ä»¶
          # --exclude="*.log": æ’é™¤æ‰€æœ‰æ—¥å¿—æ–‡ä»¶
          # --exclude="tmp*": æ’é™¤ä¸´æ—¶æ–‡ä»¶
          # --delete: åˆ é™¤ OSS ä¸Šæœ¬åœ°æ²¡æœ‰çš„æ–‡ä»¶
          # --update: ä»…åŒæ­¥æ›´æ–°çš„æ–‡ä»¶
          # --force: å¼ºåˆ¶æ‰§è¡Œ
          ossutil sync ./ oss://${{ secrets.ALIYUN_OSS_BUCKET }} \
            --exclude=".git*" \
            --exclude=".github*" \
            --exclude="*.log" \
            --exclude="tmp*" \
            --exclude=".DS_Store" \
            --delete \
            --update \
            --force
